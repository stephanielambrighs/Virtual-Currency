let message_transfer=document.querySelector(".message_transfer");localStorage.getItem("token")||(window.location.href="../login"),primus=Primus.connect("https://imd-virtual-currency-app.herokuapp.com",{reconnect:{max:1/0,min:500,retries:10}});var today=new Date,date=today.getFullYear()+"-"+(today.getMonth()+1)+"-"+today.getDate();console.log(date);let userFrom,btn=document.querySelector("#card__btn"),userTo="",coins="",reason="",description="";btn.addEventListener("click",function(e){userTo=document.querySelector("#receiver").value,coins=document.querySelector("#card__amount").value,reason=document.querySelector("#card__reason").value,description=document.querySelector("#card__description").value,postTransfer(),userTo=document.querySelector("#receiver").value="",coins=document.querySelector("#card__amount").value="",reason=document.querySelector("#card__reason").value="",description=document.querySelector("#card__description").value=""});let postTransfer=()=>{fetch("https://imd-virtual-currency-app.herokuapp.com/api/v1/transfers",{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({userFrom:userFrom,userTo:userTo,coins:coins,reason:reason,description:description,date:date})}).then(e=>e.json()).then(e=>{message_transfer.innerHTML=e.message,primus.write({action:"addTransfer",data:e})}).catch(e=>{})},usersArray=[],getAllUser=()=>{fetch("https://imd-virtual-currency-app.herokuapp.com/api/v1/transfers/allUsers",{method:"get",headers:{"content-type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{e.users.forEach(e=>{usersArray.push(e.fullname)}),autocomplete(document.getElementById("receiver"),usersArray)}).catch(e=>{console.log(e)})};getAllUser();let getUserData=()=>{fetch("https://imd-virtual-currency-app.herokuapp.com/api/v1/transfers/user",{method:"get",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{fullUserName=e.user[0].fullname,printTransfers(),document.querySelector(".header__coins").innerHTML=e.user[0].coins+" coins",document.querySelector(".card__coinsAmount").innerHTML="â‚¬"+e.user[0].coins;let t=document.querySelector(".headerD__name"),r=document.querySelector(".header__name");t.innerHTML=e.user[0].fullname,r.innerHTML=e.user[0].fullname}).catch(e=>{})};function autocomplete(e,t){var r;function n(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),r>=e.length&&(r=0),r<0&&(r=e.length-1),e[r].classList.add("autocomplete-active")}function o(t){for(var r=document.getElementsByClassName("autocomplete-items"),n=0;n<r.length;n++)t!=r[n]&&t!=e&&r[n].parentNode.removeChild(r[n])}e.addEventListener("input",function(n){var a,s,c,u=this.value;if(o(),!u)return!1;for(r=-1,(a=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),a.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(a),c=0;c<t.length;c++)t[c].substr(0,u.length).toUpperCase()==u.toUpperCase()&&((s=document.createElement("DIV")).innerHTML="<strong>"+t[c].substr(0,u.length)+"</strong>",s.innerHTML+=t[c].substr(u.length),s.innerHTML+="<input type='hidden' value='"+t[c]+"'>",s.addEventListener("click",function(t){e.value=this.getElementsByTagName("input")[0].value,o()}),a.appendChild(s))}),e.addEventListener("keydown",function(e){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(r++,n(t)):38==e.keyCode?(r--,n(t)):13==e.keyCode&&(e.preventDefault(),r>-1&&t&&t[r].click())}),document.addEventListener("click",function(e){o(e.target)})}getUserData();